/* @copyright Stadt Wien - Wiener Melange 200 */
import{s as r}from"../../lit-element-8d7b5fe2.js";import{x as e}from"../../lit-html-34d0b6a8.js";import{o as t}from"../../if-defined-d257cee1.js";import{FormWrapper as i}from"../misc/form-wrapper.js";import{f as s}from"../../form.styles-3cb5bbeb.js";import{n as o}from"../../when-741bb8d9.js";import{ErrorStateController as a}from"../misc/error-state-controller.js";import{dispatchCustomEvent as n}from"../misc/utils.js";import{g as l}from"../../wiener-melange.bundle.min-ae18d627.js";import"../misc/slot.js";import"../../class-map-b15037ef.js";import"../../directive-16e189ed.js";import"../../unsafe-html-4e49b66a.js";import"../misc/error-tracking.js";const h=new CSSStyleSheet;h.replaceSync(l);class d extends(i(r)){static properties={errormessage:{type:String,attribute:"errormessage"},summaryErrormessage:{type:String,attribute:"summary-errormessage"},hasGroupError:{type:Boolean,reflect:!0},error:{type:String},legend:{type:String,reflect:!0},_hasInteracted:{type:Boolean,state:!0},validate:{type:Boolean,reflect:!0}};static styles=[h,s];constructor(){super(),this.errormessage="",this.summaryErrormessage="",this.hasGroupError=!1,this._error="",this.legend="Gruppe",this._hasInteracted=!1,this.validate=!1,this._errorController=new a(this),this._inErrorSetting=!1,this._isValidating=!1}connectedCallback(){super.connectedCallback(),this._setupMutationObserver(),setTimeout((()=>{this._setupChildEventListeners()}),0)}_setupMutationObserver(){this._observer=new MutationObserver((r=>{let e=!1;r.forEach((r=>{"childList"===r.type&&(r.addedNodes.length>0||r.removedNodes.length>0)&&(e=!0)})),e&&(this._setupChildEventListeners(),this.hasGroupError&&this.validateGroup())})),this._observer.observe(this,{childList:!0,subtree:!0})}_setupChildEventListeners(){this.querySelectorAll("wm-input, wm-select, wm-textarea, wm-radio, wm-checkbox, wm-upload, wm-switch, input, select, textarea").forEach((r=>{r.removeEventListener("input",this._onChildInput),r.removeEventListener("change",this._onChildChange),r.removeEventListener("blur",this._onChildBlur),r.addEventListener("input",this._onChildInput.bind(this)),r.addEventListener("change",this._onChildChange.bind(this)),r.addEventListener("blur",this._onChildBlur.bind(this))}))}_onChildInput(r){this._hasInteracted=!0,this.validate&&this._debounceValidation()}_onChildChange(r){this._hasInteracted=!0,this._debounceValidation()}_onChildBlur(r){this._hasInteracted=!0,this._debounceValidation()}_debounceValidation(){clearTimeout(this._validationTimer),this._validationTimer=setTimeout((()=>{this._isValidating||this.validateGroup()}),50)}disconnectedCallback(){super.disconnectedCallback(),this._observer&&this._observer.disconnect(),clearTimeout(this._validationTimer)}checkValidity(){if(this.hasGroupError&&this.errormessage)return this.errormessage;const r=this.validateGroup();return r&&"object"==typeof r&&r.message?r.message:""}validateGroup(){if(this._isValidating)return"";try{this._isValidating=!0;let r=!1,e=null;const t=[];if(!this._hasInteracted&&!this.showErrors)return"";this.querySelectorAll("wm-input, wm-select, wm-textarea, wm-radio, wm-checkbox, wm-upload, wm-switch, input, select, textarea").forEach((i=>{if("function"==typeof i.checkValidity){const s=i.checkValidity(),o=i.hasAttribute("required")&&(!i.value||"string"==typeof i.value&&""===i.value.trim()||Array.isArray(i.value)&&0===i.value.length);if(""!==s&&!0!==s||o||i.hasError){if(i.hasError=!0,"setAttribute"in i&&i.setAttribute("haserror",""),t.push(i),i._errorController){const r=i.errormessage||s||"Invalid input";i._errorController.setError(r)}r=!0,!e&&i.id&&(e=i.id)}}}));const i=this.hasGroupError;if(this.hasGroupError=r,r&&!e&&(this.id||(this.id="wm-form-group-"+Math.random().toString(36).substr(2,9)),e=this.id),r){const s=this.errormessage||"Group validation error.";return this._errorController.setError(s,{announceToScreenReader:i!==r}),n(this,"group-invalid",{message:s,fieldId:e,invalidFields:t}),{message:s,firstInvalidFieldId:e,invalidFields:t}}return this._errorController.clearError(),i!==r&&n(this,"group-valid",{}),""}finally{this._isValidating=!1}}_setErrorDirectly(r){this._error=r,this.requestUpdate()}get error(){return this.hasGroupError?this.errormessage:this._error}set error(r){if(!this._inErrorSetting){this._inErrorSetting=!0,this._error=r;try{this._errorController&&void 0!==r&&(r?(this.hasGroupError=!0,this._errorController.setError(r)):(this.hasGroupError=!1,this._errorController.clearError())),this.requestUpdate()}finally{this._inErrorSetting=!1}}}showError(r){if(!this._inErrorSetting){this._inErrorSetting=!0;try{this.hasGroupError=!!r,this._error=r||"",r?this._errorController.setError(r):this._errorController.clearError(),this.requestUpdate()}finally{this._inErrorSetting=!1}}}clearError(){this.showError("")}setDisabled(r){this.disabled=Boolean(r),r&&(this._errorController.clearError(),this.hasGroupError=!1);this.querySelectorAll("wm-input, wm-select, wm-textarea, wm-radio, wm-checkbox, wm-upload, wm-switch").forEach((e=>{"function"==typeof e.setDisabled?e.setDisabled(r):(e.disabled=r,r?e.setAttribute("disabled",""):e.removeAttribute("disabled"))}));this.querySelectorAll("input, select, textarea, button").forEach((e=>{r?e.setAttribute("disabled",""):e.removeAttribute("disabled")})),n(this,"disabled-changed",{disabled:this.disabled})}render(){return e`
      <fieldset
        class="${this.hasGroupError?"group-error":""}"
        aria-invalid="${t(this.hasGroupError?"true":void 0)}"
        aria-describedby="${t(this.hasGroupError&&this.error?"error-message":void 0)}"
      >
        <legend>
          ${this.legend}
        </legend>
        <slot></slot>
      </fieldset>

      ${o(this.hasGroupError&&this.error,(()=>e`
          <div class="wm-forms-message" id="error-message">
            <div class="has-error">
              <slot name="error">${this.error}</slot>
            </div>
          </div>
        `))}
    `}}customElements.define("wm-form-group",d);export{d as FormGroup};
