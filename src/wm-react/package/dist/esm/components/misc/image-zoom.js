/* @copyright Stadt Wien - Wiener Melange 200 */
let t=!1,e=1,i=1;const o={active:!1,x:0,targetX:0,y:0,startDist:0,dist:0,lastDist:1,offset:32};let n=Object.assign({},o);const s={lastX:0,lastY:0,moving:!1,moved:!1};let a,h=Object.assign({},s),c=!1,m=()=>{};const r=new Event("reset");let l,g,d,u,v,p=!1;const f=function(t){return console.info("ðŸŒˆ Image zoom initialisieren."),this.image={elem:t.img},this.ready=!1,setTimeout((()=>{this.image.zoomedClass=t.zoomedClass,this.image.container=t.container,this.image.zoomEvent=t.zoomEvent,this.getImageData(),t.onReset&&(m=t.onReset),this.container="string"==typeof t.container?document.querySelector(t.container):t.container,this.addEvents(),console.info("âœ… Image zoomt bereit."),console.info(" "),this.ready=!0,this.image.zoomEvent&&("dblclick"===t.zoomEventType?this.zoomOnDoubleTap(this.image.zoomEvent):this.zoomOnPinch(this.image.zoomEvent))}),150),this};f.prototype.getImageData=function(){this.image.originalHeight=this.image.elem.height,this.image.originalRect=this.image.elem.getBoundingClientRect(),this.setXandY()},f.prototype.setXandY=function(){if(this.image.container){const t=this.image.elem,e=this.image.container.getBoundingClientRect();this.image.x=Math.round(t.getBoundingClientRect().left-e.left),this.image.y=Math.round(t.getBoundingClientRect().top-e.top)}},f.prototype.isDoubleTap=function(){return!!p||(p=!0,window.setTimeout((function(){p=!1}),300),!1)},f.prototype.pinchGetDist=function(t){return Math.hypot(t.touches[0].clientX-t.touches[1].clientX,t.touches[0].clientY-t.touches[1].clientY)},f.prototype.resizeImage=function(){this.resetZoom(),this.getImageData()},f.prototype.addEvents=function(){g=this.resizeImage.bind(this),d=this.startHandler.bind(this),u=this.moveHandler.bind(this),v=this.endHandler.bind(this),l=m(),this.container.addEventListener("touchstart",d),this.container.addEventListener("touchmove",u),this.container.addEventListener("touchend",v),this.container.addEventListener("reset",l),this.container.addEventListener("resize",g),console.info("ðŸ‘‰ Events attachen.")},f.prototype.destroyEvents=function(){this.container&&(this.container.removeEventListener("touchstart",d),this.container.removeEventListener("touchmove",u),this.container.removeEventListener("touchend",v),this.container.removeEventListener("resize",g),this.container.removeEventListener("reset",l),console.info("ðŸ‘‰ Events destroyen."))},f.prototype.zoomOnPinch=function(t){n.active=!0,n.x=(t.touches[0].clientX+t.touches[1].clientX)/2,n.y=(t.touches[0].clientY+t.touches[1].clientY)/2,n.startDist=this.pinchGetDist(t),console.info("ðŸ‘‰ Zoom: pinch.")},f.prototype.zoomOnDoubleTap=function(o){h.moving=!1,i=e,t?this.resetZoom():(e=2,this.zoom(o.touches[0].clientX,o.touches[0].clientY)),console.info("ðŸ‘‰ Zoom: double tap.")},f.prototype.resetZoom=function(){e=1,i=1,this.image.elem.removeAttribute("style"),this.image.elem.classList.remove(this.image.zoomedClass),t=!1,this.setXandY(),n=o,h=s,document.body.classList.remove("wm-is-zoomed"),this.container&&(this.container.classList.remove("wm-zoom-active"),this.container.dispatchEvent(r)),console.info("ðŸ‘‰ Zoom: reset.")},f.prototype.moveImage=function(t,e){clearInterval(c),c=!1;const i=this.image.container.getBoundingClientRect();t>i.width/2&&(t=i.width/2),e>i.height/2&&(e=i.height/2),this.image.elem.getBoundingClientRect().height+e<=i.height/2&&(e=-1*(this.image.elem.getBoundingClientRect().height-i.height/2)),this.image.elem.getBoundingClientRect().width+t<=i.width/2&&(t=-1*(this.image.elem.getBoundingClientRect().width-i.width/2)),this.image.elem.style.transform=`translateX(${t}px) translateY(${e}px)`,this.image.x=t,this.image.y=e},f.prototype.zoom=function(o,n){this.image.elem.removeAttribute("width"),this.image.elem.style.height=this.image.originalRect.height*e+"px";const s=this.image.container.getBoundingClientRect(),a=(s.width-this.image.originalRect.width)/2,h=(s.height-this.image.originalRect.height)/2,c=o-this.image.originalRect.left+a,m=n-this.image.originalRect.top+h,r=c-(-1*this.image.x+c)/i*e,l=m-(-1*this.image.y+m)/i*e;t=!0,this.container.classList.add("wm-zoom-active"),document.body.classList.add("wm-is-zoomed"),this.image.elem.classList.add(this.image.zoomedClass),this.moveImage(r,l)},f.prototype.startHandler=function(e,i=!1){if(e.preventDefault(),"true"===this.image.elem.dataset.wmZoomDisable)return void console.warn("ðŸ‘‰ Zoom disabled.");if(console.info("ðŸ‘‰ Start touch."),2===e.touches.length)return void this.zoomOnPinch(e);h.lastX=e.touches[0].clientX,h.lastY=e.touches[0].clientY,t&&(a=performance.now(),c&&(clearInterval(c),c=!1));if(!this.isDoubleTap()&&!i)return h.moving=!0,!1;h.moved||this.zoomOnDoubleTap(e)},f.prototype.moveHandler=function(o){if("true"!==this.image.elem.dataset.wmZoomDisable&&(n.active&&(n.dist=this.pinchGetDist(o),i=e,e=n.dist>n.lastDist?n.lastDist*Math.abs(n.dist/n.startDist):n.lastDist*Math.abs(n.startDist/n.dist),e>=5&&(e=5),e<1?this.resetZoom():(t=!0,t&&(h.moving=!1,this.zoom(n.x,n.y)))),h.moving&&t)){h.moved=!1,performance.now()-a>60&&(h.moved=!0);const t=Math.round(h.lastX-o.touches[0].clientX),e=Math.round(h.lastY-o.touches[0].clientY);h.lastX=o.touches[0].clientX,h.lastY=o.touches[0].clientY;const i=this.image.x-t,n=this.image.y-e;this.moveImage(i,n)}},f.prototype.endHandler=function(){n.active=!1,n.lastDist=e,h.moving=!1,h.moved=!1,console.info("ðŸ‘‰ End touch.")};const y=t=>{if(2===t.touches.length)return t.preventDefault(),!1};export{f as WmImageZoom,y as preventPinchZoom};
