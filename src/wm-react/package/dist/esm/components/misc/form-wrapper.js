/* @copyright Stadt Wien - Wiener Melange 200 */
import{s as t}from"../../lit-element-8d7b5fe2.js";import{x as e}from"../../lit-html-34d0b6a8.js";import{n as i}from"../../when-741bb8d9.js";import{SlotController as s}from"./slot.js";import{randomHash as r,dispatchCustomEvent as o}from"./utils.js";import{e as h}from"../../class-map-b15037ef.js";import{ErrorStateController as a}from"./error-state-controller.js";import"../../unsafe-html-4e49b66a.js";import"../../directive-16e189ed.js";import"./error-tracking.js";const l=l=>{class n extends l{get _item(){return this.shadowRoot?.querySelectorAll("input, select, textarea, [role='switch']")[0]??null}static formAssociated=!0;static shadowRootOptions={...t.shadowRootOptions,delegatesFocus:!0};static properties={error:{type:String},hasError:{type:Boolean,reflect:!0},hideAsterisk:{type:Boolean},id:{type:String,reflect:!0},hint:{type:String},label:{type:String},name:{type:String},required:{type:Boolean},requiredText:{type:String},validate:{type:Boolean},value:{type:String},_hasHint:{type:Boolean},_formId:{type:String,attribute:!1},_id:{type:String,attribute:!1}};constructor(){super(),this.error=void 0,this.hasError=!1,this.hideAsterisk=!1,this.id=void 0,this.name=void 0,this.value="",this.label="",this.required=!1,this.requiredText="Pflichtfeld",this.validate=!1,this._internals=this.attachInternals(),this._slotController=new s(this),this._id=`${r()}`,this._formId=`wm-form-item-${this._id}`,this.hint=void 0,this._hasHint=!1,this._errorController=new a(this)}connectedCallback(){super.connectedCallback(),this.id||(this.id=this._id)}firstUpdated(){""!==this.label&&"true"!==this.label||"radio"===!this.type&&console.error("Das label muss angegeben werden! Um labels zu verstecken, hideLabel verwenden."),this._setValidity()}updated(t){t.has("id")&&(this._id=this.id,this._formId=`wm-form-item-${this._id}`),this.hasError=this.error||this._slotController.hasNamedSlot("error"),this._hasHint=this.hint||this._slotController.hasNamedSlot("hint")}checkValidity(){if(this._item&&"function"==typeof this._item.checkValidity){if(this._item.checkValidity())return this._errorController.clearError(),"";{const t=this._item.validationMessage;return this._errorController.setError(t),t}}return this._errorController.validate(),this.error||""}_defineErrorMessages(){if(!this._item)return;const t=this._item.validity;if(t){if(this._item.setCustomValidity(""),"switch"===this.type&&this.required){let t="";t=this.checked?"":"Bestätigen Sie die Option",this._item.setCustomValidity(t)}if(t.typeMismatch&&"email"===this.type&&this._item.setCustomValidity("Geben Sie eine gültige E-Mail Adresse an"),t.typeMismatch&&"url"===this.type&&this._item.setCustomValidity("Geben Sie eine gültige URL beginnend mit https:// an"),t.valueMissing){let t="Füllen Sie dieses Feld aus.";"password"===this.type&&(t="Geben Sie ein Passwort ein."),"file"===this._item.type&&(t="Wählen Sie Dateien aus."),"radio"===this.type&&(t="Bitte wählen Sie eine Option aus."),"checkbox"===this.type&&(t="Bitte wählen Sie die Option aus."),this._item.setCustomValidity(t)}}}_setValidity(){setTimeout((()=>{if(!this._item)return;this._defineErrorMessages();const t=this._item.validationMessage||"Invalid input";this._internals.setValidity(this._item.validity,t,this._item)}),0)}_renderLabel(t,s){const r={"has-error":this.hasError,"wm-h-vh":this.hideLabel};return e`
				<label for="${s||this._formId}" class="${h(r)}">
					${t||this.label}
					${i("radio"!==this.type&&"checkbox"!==this.type,(()=>e` ${this._showRequired()} `))}
				</label>
			`}_showRequired(){return e`${i(this.required,(()=>e`
					${this.hideAsterisk?`(${this.requiredText})`:e`<abbr title="${this.requiredText}">*</abbr>`}
				`))}`}_dispatchFormEvent(t,e={}){this.dispatchEvent(new Event(t,{bubbles:!0,composed:!0}))}_dispatchCustomEvent(t,e={}){o(this,t,e)}_handleBlur(t){this.dispatchEvent(new Event("blur",{bubbles:!0,composed:!0})),this._dispatchCustomEvent("blur",{value:t.target.value,target:t.composedPath()[0]})}_handleFocus(t){this.dispatchEvent(new Event("focus",{bubbles:!0,composed:!0})),this._dispatchCustomEvent("focus",{value:t.target.value,target:t.composedPath()[0]})}_handleInvalid(t){this._errorController.setError(t),this.dispatchEvent(new Event("invalid",{bubbles:!0,composed:!0}))}reset(){this.value="",this._value=void 0,this._errorController.clearError(),this.hasError=!1,this._item&&(this._item.value=""),this.dispatchEvent(new Event("reset",{bubbles:!0,composed:!0}))}_renderWrapper(t){return e`
				${t}
				${i(this.hasError,(()=>e`
						<div class="wm-forms-message" id="error-message">
							<div class="has-error">
								<slot name="error">${this.error}</slot>
							</div>
						</div>
					`))}
			`}}return n};export{l as FormWrapper};
